// Start of the flow.
Flow co.acme.password
     Basepath ""
// Get authentication service reference from the IDP
authServiceRef = Call io.jans.as.server.service.AuthenticationService#class 
// Get CdiUtil service reference from the IDP
cdiUtilRef = Call io.jans.service.cdi.util.CdiUtil#bean authServiceRef
// Create empty object to store the authentication result
authResult = {}
// Retry 3 times to get the correct username and password 
Repeat 3 times max
     // Load login page for username and password input
     creds = RRF "login.ftlh" authResult
     // Validate username and password with IDP
     authResult.success = Call cdiUtilRef authenticate creds.username creds.password
     // Keep the username to show on when user is retrying authentication
     authResult.uid = creds.username
     // Check if the authentication was successful 
     When authResult.success is true
          // Authentication successful. Return the username.
          Finish authResult.uid
// Max number of failed authentication attempts reached. return error and end the flow 
it_mhdje = {success:false, error: "Maximum authentication attempts reached. Authentication failed."}
Finish it_mhdje